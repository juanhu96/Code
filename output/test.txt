/mnt/phd/jihu/opioid/Code/risk_test.py:36: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
/mnt/phd/jihu/opioid/Code/risk_test.py:532: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  FULL_filtered.rename(columns={'prescriber_yr_avg_days_quartile_binary': 'prescriber_yr_avg_days_median_binary',\
Start testing with table:
Intercept: -7

 - Condition: num_prior_prescriptions, Cutoff: 1, Score: 2
 - Condition: prescriber_yr_avg_days_quartile, Cutoff: 1, Score: 2
 - Condition: concurrent_MME, Cutoff: 40, Score: 1
 - Condition: age, Cutoff: 30, Score: 1
 - Condition: long_acting, Cutoff: 1, Score: 1
 - Condition: pharmacy_yr_avg_days_quartile, Cutoff: 1, Score: 1
0: Accuracy = 0.690, ROC AUC = 0.655, Calibration = 0.074
1: Accuracy = 0.696, ROC AUC = 0.655, Calibration = 0.079
----------------------------------------------------------------------------------------------------
Total prescriptions from true positive patients: 
 (372217, 131)
----------------------------------------------------------------------------------------------------
Proportion of LT users detected within a month: 57.6; two months: 79.9, three months: 89.2
1
{'test_accuracy': 0.8783711992396674, 'test_roc_auc': 0.38657953741896856, 'test_pr_auc': 0.023652342481714925, 'test_calibration_error': 0.025055000824536086}
2
{'test_accuracy': 0.41368750546230665, 'test_roc_auc': 0.4110830330965296, 'test_pr_auc': 0.08770273145165598, 'test_calibration_error': 0.10314407077781423}
3
{'test_accuracy': 0.41905105105105106, 'test_roc_auc': 0.41354602944003693, 'test_pr_auc': 0.1895610255968741, 'test_calibration_error': 0.18515695787829642}


[0, 10)
{'test_accuracy': 0.7387316791286532, 'test_recall': 0.08325741801145237, 'test_roc_auc': 0.6036873808003864, 'test_pr_auc': 0.17787436185259914, 'test_calibration_error': 0.130333258523059, 'correctly_predicted_positives_ratio': 0.01120265466580279, 'true_positives_ratio': 0.13455443290664892}
[10, 20)
{'test_accuracy': 0.8080024599120018, 'test_recall': 0.0954859958299579, 'test_roc_auc': 0.6236222919539661, 'test_pr_auc': 0.12076487269896814, 'test_calibration_error': 0.08028659912505669, 'correctly_predicted_positives_ratio': 0.008438343174154962, 'true_positives_ratio': 0.08837257338952637}
[20, 30)
{'test_accuracy': 0.809284470476492, 'test_recall': 0.10972097634672584, 'test_roc_auc': 0.6019836942401978, 'test_pr_auc': 0.06902733806178148, 'test_calibration_error': 0.04539192152339149, 'correctly_predicted_positives_ratio': 0.005748377394332753, 'true_positives_ratio': 0.05239086987494063}
[30, 40)
{'test_accuracy': 0.7806705962918162, 'test_recall': 0.14902681992337163, 'test_roc_auc': 0.5999693327929383, 'test_pr_auc': 0.0891397743102837, 'test_calibration_error': 0.06032245394430382, 'correctly_predicted_positives_ratio': 0.010372333049598184, 'true_positives_ratio': 0.06960044544285084}
[40, 50)
{'test_accuracy': 0.538182530917797, 'test_recall': 0.7960857376678101, 'test_roc_auc': 0.6182728919739942, 'test_pr_auc': 0.15965218430743847, 'test_calibration_error': 0.09391288240301628, 'correctly_predicted_positives_ratio': 0.09635730604193186, 'true_positives_ratio': 0.12103885484020536}
[50, 60)
{'test_accuracy': 0.4594353797482691, 'test_recall': 0.8622281278411078, 'test_roc_auc': 0.6160662677872485, 'test_pr_auc': 0.07091625404239706, 'test_calibration_error': 0.04839561996002233, 'correctly_predicted_positives_ratio': 0.04654455124091118, 'true_positives_ratio': 0.05398171288780834}
[60, 70)
{'test_accuracy': 0.5082366987654706, 'test_recall': 0.849476439790576, 'test_roc_auc': 0.6106673897387257, 'test_pr_auc': 0.20886550884085056, 'test_calibration_error': 0.12887235111551196, 'correctly_predicted_positives_ratio': 0.14180700138904062, 'true_positives_ratio': 0.16693459023301546}
[70, 80)
{'test_accuracy': 0.4568945949136076, 'test_recall': 0.9037562748831574, 'test_roc_auc': 0.6223953570088852, 'test_pr_auc': 0.1354953037879205, 'test_calibration_error': 0.06994542127587902, 'correctly_predicted_positives_ratio': 0.09480919218791142, 'true_positives_ratio': 0.10490570834506115}
[80, 90)
{'test_accuracy': 0.5110994832886389, 'test_recall': 0.9243548090479985, 'test_roc_auc': 0.5921950886210903, 'test_pr_auc': 0.26279831808191323, 'test_calibration_error': 0.17030245874875213, 'correctly_predicted_positives_ratio': 0.19725292694093793, 'true_positives_ratio': 0.2133952514879979}
[90, 100)
{'test_accuracy': 0.48287380334718427, 'test_recall': 0.8683416534094026, 'test_roc_auc': 0.5825858054556239, 'test_pr_auc': 0.24307039790533205, 'test_calibration_error': 0.15792374060934827, 'correctly_predicted_positives_ratio': 0.1816960903602011, 'true_positives_ratio': 0.20924493216097706}
above 100
{'test_accuracy': 0.4702523564630418, 'test_recall': 0.924099316851354, 'test_roc_auc': 0.5607901760391056, 'test_pr_auc': 0.26711465796920386, 'test_calibration_error': 0.17384374598742575, 'correctly_predicted_positives_ratio': 0.22122266477437472, 'true_positives_ratio': 0.23939273705789293}


489561 1507852
Feature: num_prior_prescriptions, Cutoff: 1
Feature: prescriber_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Feature: concurrent_MME, Cutoff: 40
Feature: age, Cutoff: 30
Feature: long_acting, Cutoff: 1
Feature: pharmacy_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Current working directory: /mnt/phd/jihu/opioid/Code
ROC information for riskSLIM saved to output/baseline/riskSLIM_roc_test_info.pkl, threshodls: [       inf 0.73105858 0.5        0.26894142 0.11920292 0.04742587
 0.01798621 0.00669285 0.00247262 0.00091105] with optimal threshold: 0.04742587317756678
Calibration information for riskSLIM saved to output/baseline/riskSLIM_calibration_test_info.pkl
Proportions information for riskSLIM saved to output/baseline/riskSLIM_proportions_test_info.pkl
Recall by MME information for riskSLIM saved to output/baseline/riskSLIM_recallMME_test_info.pkl
Test done!

                                        Value
test_accuracy                        0.470252
test_recall                          0.924099
test_roc_auc                         0.560790
test_pr_auc                          0.267115
test_calibration_error               0.173844
correctly_predicted_positives_ratio  0.221223
true_positives_ratio                 0.239393
       Prob  Num_presc       TN      FP      FN      TP  Accuracy  \
0  0.000911     148222   147214       0    1008       0    0.9932   
1  0.002473    1030479   987064       0   43415       0    0.9579   
2  0.006693     794301   763001       0   31300       0    0.9606   
3  0.017986    1412531  1247860       0  164671       0    0.8834   
4  0.047426     926372        0  749411       0  176961    0.1910   
5  0.119203     447367        0  387134       0   60233    0.1346   
6  0.268941     113710        0  103088       0   10622    0.0934   
7  0.500000      19334        0   18174       0    1160    0.0600   
8  0.731059       1069        0     878       0     191    0.1787   

   Observed Risk  Num_patients  Num_longterm  
0       0.006801        148222          1149  
1       0.042131       1030461         51017  
2       0.039406        774314         32002  
3       0.116579       1044175         62703  
4       0.191026        573706         55048  
5       0.134639        265271         17203  
6       0.093413         76582          4248  
7       0.059998         14152           705  
8       0.178672           585            77  
