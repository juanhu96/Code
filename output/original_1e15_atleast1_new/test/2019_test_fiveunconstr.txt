/mnt/phd/jihu/opioid/Code/risk_test.py:37: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
/users/phd/jihu/anaconda3/lib/python3.9/site-packages/sklearn/metrics/_classification.py:1531: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, f"{metric.capitalize()} is", len(result))
Start testing, file saved with setting tag _2019_test_all

{'intercept': -6, 'conditions': ['prescriber_yr_avg_days_quartile', 'num_prior_prescriptions', 'prescriber_yr_avg_days_quartile', 'concurrent_MME', 'pharmacy_yr_avg_days_quartile'], 'cutoffs': ['4', 1, '3', 40, '4'], 'scores': [3, 2, 2, 1, 1]}
0: Accuracy = 0.9038, ROC AUC = 0.8655, Calibration = 0.0151
1: Accuracy = 0.9067, ROC AUC = 0.8707, Calibration = 0.0123
----------------------------------------------------------------------------------------------------
Total prescriptions from true positive patients: 
 (347515, 122)
----------------------------------------------------------------------------------------------------
Proportion of LT users detected within a month: 0.49708536293220473
1
{'test_accuracy': 0.9742916696995163, 'test_recall': 0.0, 'test_precision': 0.0, 'test_roc_auc': 0.8619427495726579, 'test_pr_auc': 0.14143713929028895, 'test_calibration_error': 0.00681220973016881}
2
{'test_accuracy': 0.86806972578076, 'test_recall': 0.43219383743949685, 'test_precision': 0.3460100554338017, 'test_roc_auc': 0.8018310520694076, 'test_pr_auc': 0.2707180595718788, 'test_calibration_error': 0.07455902393795615}
3
{'test_accuracy': 0.7993556057003529, 'test_recall': 0.4374567050586964, 'test_precision': 0.512325981373111, 'test_roc_auc': 0.7655122092189466, 'test_pr_auc': 0.41473525303706743, 'test_calibration_error': 0.022277873436958022}


Test done!

                    Value
Accuracy           0.9054
Recall             0.3384
Precision          0.5115
ROC AUC            0.8684
PR AUC             0.3732
Calibration error  0.0135
       Prob  Num_presc       TN      FP      FN      TP  Accuracy  \
0  0.002473    1861691  1856614       0    5077       0    0.9973   
1  0.006693     674603   670485       0    4118       0    0.9939   
2  0.017986     989183   961367       0   27816       0    0.9719   
3  0.047426     938846   872223       0   66623       0    0.9290   
4  0.119203     604966   513759       0   91207       0    0.8492   
5  0.268941     842588   636372       0  206216       0    0.7553   
6  0.500000     325891        0  172601       0  153290    0.4704   
7  0.731059      75070        0   23257       0   51813    0.6902   

   Observed Risk  Num_patients  Num_longterm  
0       0.002727       1861691          7449  
1       0.006104        674603          5362  
2       0.028120        816686         21883  
3       0.070963        783801         53595  
4       0.150764        415395         53937  
5       0.244741        414728         70941  
6       0.470372        155567         53811  
7       0.690196         30900         16912  
