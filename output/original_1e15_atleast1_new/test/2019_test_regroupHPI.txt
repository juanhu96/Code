/mnt/phd/jihu/opioid/Code/risk_test.py:37: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
Start testing, file saved with setting tag _2019_test_all

{'intercept': -6, 'conditions': ['num_prior_prescriptions', 'prescriber_yr_avg_days_quartile', 'concurrent_MME', 'age', 'HMFO', 'patient_zip_yr_num_prescriptions_per_pop_quartile', 'pharmacy_yr_avg_days_quartile', 'family_poverty_pct_quartile'], 'cutoffs': [1, '4', 75, 40, 1, '3', '4', '4'], 'scores': [2, 2, 1, 1, 1, 1, 1, 1]}
0: Accuracy = 0.8979, ROC AUC = 0.8508, Calibration = 0.0199
1: Accuracy = 0.8991, ROC AUC = 0.8564, Calibration = 0.0180
----------------------------------------------------------------------------------------------------
Total prescriptions from true positive patients: 
 (360141, 122)
----------------------------------------------------------------------------------------------------
Proportion of LT users detected within a month: 0.5085091484762687
1
{'test_accuracy': 0.9734028572751997, 'test_recall': 0.03880446421217363, 'test_precision': 0.3459067547723935, 'test_roc_auc': 0.829078536629387, 'test_pr_auc': 0.13575533545608376, 'test_calibration_error': 0.005021396377358517}
2
{'test_accuracy': 0.8501437203026926, 'test_recall': 0.4911577770831557, 'test_precision': 0.31582633906274743, 'test_roc_auc': 0.782871965318495, 'test_pr_auc': 0.2673672227621773, 'test_calibration_error': 0.08661570181400505}
3
{'test_accuracy': 0.7852296648543866, 'test_recall': 0.4927541586234287, 'test_precision': 0.47683741050919265, 'test_roc_auc': 0.755695338857306, 'test_pr_auc': 0.41414855250489874, 'test_calibration_error': 0.03780365649237564}


Test done!

                    Value
Accuracy           0.8986
Recall             0.3782
Precision          0.4654
ROC AUC             0.854
PR AUC             0.3623
Calibration error  0.0188
        Prob  Num_presc       TN      FP      FN      TP  Accuracy  \
0   0.002473     546719   545581       0    1138       0    0.9979   
1   0.006693    1561993  1550358       0   11635       0    0.9926   
2   0.017986    1132424  1112624       0   19800       0    0.9825   
3   0.047426    1141679  1054229       0   87450       0    0.9234   
4   0.119203     886838   769598       0  117240       0    0.8678   
5   0.268941     550596   410966       0  139630       0    0.7464   
6   0.500000     318096        0  188324       0  129772    0.4080   
7   0.731059     135263        0   62301       0   72962    0.5394   
8   0.880797      33897        0   11387       0   22510    0.6641   
9   0.952574       4980        0    1230       0    3750    0.7530   
10  0.982014        353        0      80       0     273    0.7734   

    Observed Risk  Num_patients  Num_longterm  
0        0.002082        546719          1505  
1        0.007449       1561993         15104  
2        0.017485       1085986         19007  
3        0.076598        795202         44055  
4        0.132200        538309         54010  
5        0.253598        300996         55837  
6        0.407965        159759         48588  
7        0.539408         63323         26461  
8        0.664071         14765          7965  
9        0.753012          2010          1281  
10       0.773371           151            92  
