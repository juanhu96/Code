/mnt/phd/jihu/opioid/Code/risk_test.py:37: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
/users/phd/jihu/anaconda3/lib/python3.9/site-packages/sklearn/metrics/_classification.py:1531: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, f"{metric.capitalize()} is", len(result))
Start testing, file saved with setting tag _2019_test_all

{'intercept': -6, 'conditions': ['num_prior_prescriptions', 'prescriber_yr_avg_days_quartile', 'concurrent_MME', 'age', 'pharmacy_yr_avg_days_quartile'], 'cutoffs': [1, '4', 40, 30, '4'], 'scores': [2, 2, 1, 1, 1]}
ROC information for riskSLIM saved to output/baseline/riskSLIM_roc_test_info.pkl
Calibration information for riskSLIM saved to output/baseline/riskSLIM_calibration_test_info.pkl
0: Accuracy = 0.9071, ROC AUC = 0.8576, Calibration = 0.0176
1: Accuracy = 0.9090, ROC AUC = 0.8630, Calibration = 0.0189
----------------------------------------------------------------------------------------------------
Total prescriptions from true positive patients: 
 (328875, 122)
----------------------------------------------------------------------------------------------------
Proportion of LT users detected within a month: 0.491955983677838
1
{'test_accuracy': 0.9742916696995163, 'test_recall': 0.0, 'test_precision': 0.0, 'test_roc_auc': 0.8360972957263088, 'test_pr_auc': 0.15268668224522297, 'test_calibration_error': 0.00814484015430299}
2
{'test_accuracy': 0.8778454138106863, 'test_recall': 0.41187614257433247, 'test_precision': 0.37245496672291367, 'test_roc_auc': 0.7924179614563754, 'test_pr_auc': 0.2902396124208245, 'test_calibration_error': 0.055225714424401995}
3
{'test_accuracy': 0.8075241174599809, 'test_recall': 0.4158346341057921, 'test_precision': 0.5395086878370282, 'test_roc_auc': 0.7700326699286026, 'test_pr_auc': 0.44275834526927227, 'test_calibration_error': 0.0357006352600558}


Test done!

                    Value
Accuracy           0.9082
Recall             0.3179
Precision          0.5371
ROC AUC            0.8607
PR AUC             0.3814
Calibration error  0.0176
       Prob  Num_presc       TN      FP      FN      TP  Accuracy  \
0  0.002473     406931   406534       0     397       0    0.9990   
1  0.006693    2028830  2013076       0   15754       0    0.9922   
2  0.017986     951232   936138       0   15094       0    0.9841   
3  0.047426    1179767  1074479       0  105288       0    0.9108   
4  0.119203     998500   849908       0  148592       0    0.8512   
5  0.268941     388866   260506       0  128360       0    0.6699   
6  0.500000     285327        0  143527       0  141800    0.4970   
7  0.731059      73385        0   22510       0   50875    0.6933   

   Observed Risk  Num_patients  Num_longterm  
0       0.000976        406931           542  
1       0.007765       2028830         20767  
2       0.015868        932461         17062  
3       0.089245        799532         57345  
4       0.148815        556343         57884  
5       0.330088        222342         56347  
6       0.496974        135526         50456  
7       0.693262         30083         16571  
