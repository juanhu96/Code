/mnt/phd/jihu/opioid/Code/risk_test.py:37: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
/users/phd/jihu/anaconda3/lib/python3.9/site-packages/sklearn/metrics/_classification.py:1531: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, f"{metric.capitalize()} is", len(result))
Start testing, file saved with setting tag _2019_test_all

{'intercept': -7, 'conditions': ['num_prior_prescriptions', 'prescriber_yr_avg_days_quartile', 'concurrent_MME', 'age', 'Medicare', 'pharmacy_yr_avg_days_quartile'], 'cutoffs': [1, '1', 75, 30, 1, '1'], 'scores': [2, 2, 1, 1, 1, 1]}
Note: encoding quartile values to binary...

0: Accuracy = 0.8984, ROC AUC = 0.8477, Calibration = 0.0193
1: Accuracy = 0.8972, ROC AUC = 0.8518, Calibration = 0.0219
----------------------------------------------------------------------------------------------------
Total prescriptions from true positive patients: 
 (223569, 122)
----------------------------------------------------------------------------------------------------
Proportion of LT users detected within a month: 0.5004117259552042
1
{'test_accuracy': 0.9742916696995163, 'test_recall': 0.0, 'test_precision': 0.0, 'test_roc_auc': 0.8386161282505918, 'test_pr_auc': 0.09218737040874768, 'test_calibration_error': 0.009029036363903566}
2
{'test_accuracy': 0.8643686459607149, 'test_recall': 0.22391141674481166, 'test_precision': 0.2569679972171493, 'test_roc_auc': 0.7593146562970517, 'test_pr_auc': 0.19706226184034875, 'test_calibration_error': 0.05863335670754534}
3
{'test_accuracy': 0.7719480244127758, 'test_recall': 0.23169143522153154, 'test_precision': 0.40220301752473187, 'test_roc_auc': 0.7120986122263725, 'test_pr_auc': 0.3267577968861674, 'test_calibration_error': 0.04156204655027365}


Test done!

                    Value
Accuracy           0.8977
Recall             0.2027
Precision          0.4305
ROC AUC              0.85
PR AUC             0.3083
Calibration error  0.0208
       Prob  Num_presc       TN      FP      FN      TP  Accuracy  \
0  0.000911     298788   298640       0     148       0    0.9995   
1  0.002473    1290640  1287387       0    3253       0    0.9975   
2  0.006693     950230   943868       0    6362       0    0.9933   
3  0.017986     998180   962932       0   35248       0    0.9647   
4  0.047426     959966   882377       0   77589       0    0.9192   
5  0.119203     713898   587702       0  126196       0    0.8232   
6  0.268941     815709   581226       0  234483       0    0.7125   
7  0.500000     261688        0  152273       0  109415    0.4181   
8  0.731059      23739        0   10273       0   13466    0.5673   

   Observed Risk  Num_patients  Num_longterm  
0       0.000495        298788           210  
1       0.002520       1290640          4618  
2       0.006695        937005          8004  
3       0.035312        830344         29156  
4       0.080825        788627         64294  
5       0.176770        426998         51472  
6       0.287459        385358         73797  
7       0.418112        122284         35195  
8       0.567252         11043          4525  
