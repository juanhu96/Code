/mnt/phd/jihu/opioid/Code/risk_test.py:37: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
Start testing, file saved with setting tag _2019_test_all

{'intercept': -7, 'conditions': ['num_prior_prescriptions', 'prescriber_yr_avg_days_quartile', 'concurrent_MME', 'concurrent_benzo', 'age', 'HMFO', 'prescriber_yr_num_prescriptions_quartile', 'prescriber_yr_num_patients_quartile', 'pharmacy_yr_num_patients_quartile', 'pharmacy_yr_avg_days_quartile'], 'cutoffs': [1, '4', 75, 1, 30, 1, '4', '3', '1', '4'], 'scores': [2, 2, 1, 1, 1, 1, 1, 1, 1, 1]}
0: Accuracy = 0.9035, ROC AUC = 0.8549, Calibration = 0.0235
1: Accuracy = 0.9035, ROC AUC = 0.8602, Calibration = 0.0229
----------------------------------------------------------------------------------------------------
Total prescriptions from true positive patients: 
 (323895, 122)
----------------------------------------------------------------------------------------------------
Proportion of LT users detected within a month: 0.487387847913839
1
{'test_accuracy': 0.9738726732529132, 'test_recall': 0.01803805287867556, 'test_precision': 0.3444073127580106, 'test_roc_auc': 0.8340538334660084, 'test_pr_auc': 0.1369758522380949, 'test_calibration_error': 0.008455608983387632}
2
{'test_accuracy': 0.8708981052384583, 'test_recall': 0.38855578604378016, 'test_precision': 0.34321165318228597, 'test_roc_auc': 0.7882157052769811, 'test_pr_auc': 0.26998663026320413, 'test_calibration_error': 0.05315477937428153}
3
{'test_accuracy': 0.7947384561796732, 'test_recall': 0.3890587333401066, 'test_precision': 0.499052200080563, 'test_roc_auc': 0.7569233568051462, 'test_pr_auc': 0.4114871736924642, 'test_calibration_error': 0.040525830540996524}


Test done!

                    Value
Accuracy           0.9035
Recall              0.309
Precision          0.4961
ROC AUC             0.858
PR AUC             0.3664
Calibration error  0.0231
        Prob  Num_presc       TN      FP      FN      TP  Accuracy  \
0   0.000911      62287    62187       0     100       0    0.9984   
1   0.002473     715439   712742       0    2697       0    0.9962   
2   0.006693    1967205  1950828       0   16377       0    0.9917   
3   0.017986     746166   722529       0   23637       0    0.9683   
4   0.047426    1298838  1181842       0  116996       0    0.9099   
5   0.119203     631379   531739       0   99640       0    0.8422   
6   0.268941     514027   354608       0  159419       0    0.6899   
7   0.500000     266882        0  146906       0  119976    0.4495   
8   0.731059      87144        0   35724       0   51420    0.5901   
9   0.880797      20745        0    6721       0   14024    0.6760   
10  0.952574       2604        0     798       0    1806    0.6935   
11  0.982014        122        0      54       0      68    0.5574   

    Observed Risk  Num_patients  Num_longterm  
0        0.001605         62287           121  
1        0.003770        715439          3476  
2        0.008325       1964376         21108  
3        0.031678        687565         18865  
4        0.090077        863400         61631  
5        0.157813        401257         50311  
6        0.310137        275749         62712  
7        0.449547        138077         47579  
8        0.590058         42291         19885  
9        0.676018          9527          5210  
10       0.693548          1281           733  
11       0.557377            59            28  
