/mnt/phd/jihu/opioid/Code/risk_test.py:37: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
/users/phd/jihu/anaconda3/lib/python3.9/site-packages/sklearn/metrics/_classification.py:1531: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, f"{metric.capitalize()} is", len(result))
Start testing, file saved with setting tag _2019_test_all

{'intercept': -11, 'conditions': ['patient_zip_yr_num_prescriptions_per_pop_quartile', 'patient_zip_yr_num_prescriptions_per_pop_quartile', 'patient_zip_yr_num_prescriptions_per_pop_quartile', 'patient_zip_yr_num_prescriptions_per_pop_quartile', 'num_prior_prescriptions', 'prescriber_yr_avg_days_quartile', 'concurrent_MME', 'age', 'prescriber_yr_avg_days_quartile', 'unemployment_pct_quartile'], 'cutoffs': ['1', '2', '3', '4', 1, '4', 100, 30, '3', '4'], 'scores': [5, 5, 5, 5, 2, 2, 1, 1, 1, 1]}
0: Accuracy = 0.9034, ROC AUC = 0.8303, Calibration = 0.0131
1: Accuracy = 0.9029, ROC AUC = 0.8361, Calibration = 0.0147
----------------------------------------------------------------------------------------------------
Total prescriptions from true positive patients: 
 (240182, 122)
----------------------------------------------------------------------------------------------------
Proportion of LT users detected within a month: 0.4935960591133005
1
{'test_accuracy': 0.9742916696995163, 'test_recall': 0.0, 'test_precision': 0.0, 'test_roc_auc': 0.8200786399554438, 'test_pr_auc': 0.11757585177275796, 'test_calibration_error': 0.008805879738560066}
2
{'test_accuracy': 0.8765440343665252, 'test_recall': 0.29475339338656664, 'test_precision': 0.3329588375651355, 'test_roc_auc': 0.762886859703534, 'test_pr_auc': 0.23389307370154266, 'test_calibration_error': 0.07086956831995792}
3
{'test_accuracy': 0.7924970847026397, 'test_recall': 0.3002521497381522, 'test_precision': 0.489873417721519, 'test_roc_auc': 0.7275524601075928, 'test_pr_auc': 0.3708646920555781, 'test_calibration_error': 0.0281544559555164}


Test done!

                    Value
Accuracy           0.9031
Recall             0.2392
Precision          0.4904
ROC AUC            0.8337
PR AUC             0.3316
Calibration error   0.014
        Prob  Num_presc       TN      FP      FN      TP  Accuracy  \
0   0.000017      13249    13246       0       3       0    0.9998   
1   0.000045      68435    67574       0     861       0    0.9874   
2   0.000123      19583    18984       0     599       0    0.9694   
3   0.000335      34191    28748       0    5443       0    0.8408   
4   0.000911      15816    12241       0    3575       0    0.7740   
5   0.002473     352119   342797       0    9322       0    0.9735   
6   0.006693    1692048  1682676       0    9372       0    0.9945   
7   0.017986    1094759  1076755       0   18004       0    0.9836   
8   0.047426    1060340   991722       0   68618       0    0.9353   
9   0.119203     949078   817247       0  131831       0    0.8611   
10  0.268941     717594   504044       0  213550       0    0.7024   
11  0.500000     271688        0  143225       0  128463    0.4728   
12  0.731059      23938        0    7419       0   16519    0.6901   

    Observed Risk  Num_patients  Num_longterm  
0        0.000226         13249             6  
1        0.012581         68435           990  
2        0.030588         19222           677  
3        0.159194         27467          3904  
4        0.226037          9022          1417  
5        0.026474        342282          3541  
6        0.005539       1688853          9184  
7        0.016446       1079086         21891  
8        0.064713        829702         57135  
9        0.138904        549076         55792  
10       0.297592        333479         66267  
11       0.472833        116800         39951  
12       0.690074          8620          4784  
