/mnt/phd/jihu/opioid/Code/risk_test.py:37: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
Start testing, file saved with setting tag _2019_test_all

{'intercept': -6, 'conditions': ['num_prior_prescriptions', 'prescriber_yr_avg_days_quartile', 'concurrent_MME', 'age', 'Medicaid', 'patient_HPIQuartile', 'pharmacy_yr_avg_days_quartile'], 'cutoffs': [1, '4', 40, 40, 1, '1', '4'], 'scores': [2, 2, 1, 1, 1, 1, 1]}
0: Accuracy = 0.9022, ROC AUC = 0.8543, Calibration = 0.0162
1: Accuracy = 0.9038, ROC AUC = 0.8584, Calibration = 0.0147
----------------------------------------------------------------------------------------------------
Total prescriptions from true positive patients: 
 (367956, 122)
----------------------------------------------------------------------------------------------------
Proportion of LT users detected within a month: 0.5065703022339028
1
{'test_accuracy': 0.9737665345447086, 'test_recall': 0.03723951898525657, 'test_precision': 0.39238446517682796, 'test_roc_auc': 0.8309872919427865, 'test_pr_auc': 0.1466944522527111, 'test_calibration_error': 0.004282300839940411}
2
{'test_accuracy': 0.8583382593824314, 'test_recall': 0.5021359627935172, 'test_precision': 0.3367551772328802, 'test_roc_auc': 0.7872882781909528, 'test_pr_auc': 0.28395630158480856, 'test_calibration_error': 0.08534324066830987}
3
{'test_accuracy': 0.7976972936953854, 'test_recall': 0.5059342932880141, 'test_precision': 0.5064863015598561, 'test_roc_auc': 0.7652143678044004, 'test_pr_auc': 0.437281952981645, 'test_calibration_error': 0.03287529140815414}


Test done!

                    Value
Accuracy           0.9031
Recall             0.3789
Precision          0.4939
ROC AUC            0.8566
PR AUC             0.3739
Calibration error  0.0153
       Prob  Num_presc       TN      FP      FN      TP  Accuracy  \
0  0.002473     513898   512918       0     980       0    0.9981   
1  0.006693    1538050  1526745       0   11305       0    0.9926   
2  0.017986    1175137  1156274       0   18863       0    0.9839   
3  0.047426    1091424  1010844       0   80580       0    0.9262   
4  0.119203    1031336   894278       0  137058       0    0.8671   
5  0.268941     497941   370235       0  127706       0    0.7435   
6  0.500000     305952        0  172435       0  133517    0.4364   
7  0.731059     129118        0   54275       0   74843    0.5796   
8  0.880797      29048        0    8466       0   20582    0.7086   
9  0.952574        934        0     208       0     726    0.7773   

   Observed Risk  Num_patients  Num_longterm  
0       0.001907        513898          1308  
1       0.007350       1538050         14752  
2       0.016052       1143404         19720  
3       0.073830        804794         44762  
4       0.132894        602885         56918  
5       0.256468        287381         55934  
6       0.436399        157176         51116  
7       0.579648         59264         26871  
8       0.708551         12466          7275  
9       0.777302           441           297  
