/mnt/phd/jihu/opioid/Code/risk_test.py:33: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
Start testing, file saved with setting tag _2018_test_first_first

{'intercept': -6, 'conditions': ['prescriber_yr_avg_days_quartile', 'age', 'concurrent_MME', 'HMFO', 'ever_switch_drug', 'pharmacy_yr_avg_days_quartile'], 'cutoffs': ['4', 40, 40, 1, 1, '4'], 'scores': [3, 2, 1, 1, 1, 1]}
['patient_id', 'patient_gender', 'patient_zip', 'quantity', 'days_supply', 'date_filled', 'daily_dose', 'total_dose', 'max_dose', 'age', 'concurrent_MME', 'concurrent_methadone_MME', 'num_prescribers_past180', 'num_pharmacies_past180', 'consecutive_days', 'concurrent_benzo', 'concurrent_benzo_same', 'concurrent_benzo_diff', 'days_to_long_term', 'long_term_180', 'num_prior_prescriptions', 'num_prior_prescriptions_past180', 'num_prior_prescriptions_past90', 'num_prior_prescriptions_past30', 'switch_drug', 'switch_payment', 'ever_switch_drug', 'ever_switch_payment', 'dose_diff', 'concurrent_MME_diff', 'quantity_diff', 'days_diff', 'avgMME_past180', 'avgDays_past180', 'avgMME_past90', 'avgDays_past90', 'avgMME_past30', 'avgDays_past30', 'HMFO', 'Codeine_MME', 'Hydrocodone_MME', 'Oxycodone_MME', 'Morphine_MME', 'Hydromorphone_MME', 'Methadone_MME', 'Fentanyl_MME', 'Oxymorphone_MME', 'gap', 'num_prior_prescriptions_benzo_past180', 'num_prior_prescriptions_benzo_past90', 'num_prior_prescriptions_benzo_past30', 'patient_HPIQuartile', 'prescriber_HPIQuartile', 'pharmacy_HPIQuartile', 'zip_pop', 'zip_pop_density', 'median_household_income', 'family_poverty_pct', 'unemployment_pct', 'patient_zip_yr_num_prescriptions', 'patient_zip_yr_num_patients', 'patient_zip_yr_num_pharmacies', 'patient_zip_yr_avg_MME', 'patient_zip_yr_avg_days', 'patient_zip_yr_avg_quantity', 'patient_zip_yr_num_prescriptions_quartile', 'patient_zip_yr_num_patients_quartile', 'patient_zip_yr_num_pharmacies_quartile', 'patient_zip_yr_avg_MME_quartile', 'patient_zip_yr_avg_days_quartile', 'patient_zip_yr_avg_quantity_quartile', 'prescriber_yr_num_prescriptions', 'prescriber_yr_num_patients', 'prescriber_yr_num_pharmacies', 'prescriber_yr_avg_MME', 'prescriber_yr_avg_days', 'prescriber_yr_avg_quantity', 'prescriber_yr_num_prescriptions_quartile', 'prescriber_yr_num_patients_quartile', 'prescriber_yr_num_pharmacies_quartile', 'prescriber_yr_avg_MME_quartile', 'prescriber_yr_avg_days_quartile', 'prescriber_yr_avg_quantity_quartile', 'pharmacy_yr_num_prescriptions', 'pharmacy_yr_num_patients', 'pharmacy_yr_num_prescribers', 'pharmacy_yr_avg_MME', 'pharmacy_yr_avg_days', 'pharmacy_yr_avg_quantity', 'pharmacy_yr_num_prescriptions_quartile', 'pharmacy_yr_num_patients_quartile', 'pharmacy_yr_num_prescribers_quartile', 'pharmacy_yr_avg_MME_quartile', 'pharmacy_yr_avg_days_quartile', 'pharmacy_yr_avg_quantity_quartile', 'Codeine', 'Hydrocodone', 'Oxycodone', 'Morphine', 'Hydromorphone', 'Methadone', 'Fentanyl', 'Oxymorphone', 'Medicaid', 'CommercialIns', 'Medicare', 'CashCredit', 'MilitaryIns', 'WorkersComp', 'Other', 'IndianNation', 'zip_pop_density_quartile', 'median_household_income_quartile', 'family_poverty_pct_quartile', 'unemployment_pct_quartile', 'patient_zip_yr_num_prescriptions_per_pop', 'patient_zip_yr_num_patients_per_pop', 'patient_zip_yr_num_prescriptions_per_pop_quartile', 'patient_zip_yr_num_patients_per_pop_quartile']
Calibration curve saved as Calibration_2018_test_first_first.pdf

ROC curve saved as ROC_2018_test_first_first.pdf

Threshold: 1.95
Confusion Matrix:
[[4416074       0]
 [ 562242       0]]

Threshold: 0.95
Confusion Matrix:
[[4415131     943]
 [ 556358    5884]]

Threshold: 0.88
Confusion Matrix:
[[4408003    8071]
 [ 522486   39756]]

Threshold: 0.73
Confusion Matrix:
[[4368879   47195]
 [ 427259  134983]]

Threshold: 0.50
Confusion Matrix:
[[4206056  210018]
 [ 268110  294132]]

Threshold: 0.27
Confusion Matrix:
[[3942208  473866]
 [ 142329  419913]]

Threshold: 0.12
Confusion Matrix:
[[3789389  626685]
 [ 109498  452744]]

Threshold: 0.05
Confusion Matrix:
[[2923303 1492771]
 [  53696  508546]]

Threshold: 0.02
Confusion Matrix:
[[1375962 3040112]
 [   8330  553912]]

Threshold: 0.01
Confusion Matrix:
[[ 974995 3441079]
 [   4306  557936]]

Threshold: 0.00
Confusion Matrix:
[[      0 4416074]
 [      0  562242]]

Test done!

                    Value
Accuracy            0.904
Recall             0.5231
Precision          0.5834
ROC AUC            0.8887
PR AUC             0.5188
Calibration error  0.0143
       Prob  Num_presc       TN      FP      FN      TP  Accuracy  \
0  0.002473     979301   974995       0    4306       0    0.9956   
1  0.006693     404991   400967       0    4024       0    0.9901   
2  0.017986    1592707  1547341       0   45366       0    0.9715   
3  0.047426     921888   866086       0   55802       0    0.9395   
4  0.119203     185650   152819       0   32831       0    0.8232   
5  0.268941     389629   263848       0  125781       0    0.6772   
6  0.500000     321972        0  162823       0  159149    0.4943   
7  0.731059     134351        0   39124       0   95227    0.7088   
8  0.880797      41000        0    7128       0   33872    0.8261   
9  0.952574       6827        0     943       0    5884    0.8619   

   Observed Risk  Num_patients  Num_longterm  
0       0.004397        978754          5478  
1       0.009936        402023          4789  
2       0.028484       1584950         54412  
3       0.060530        898732         62807  
4       0.176844        160576         31741  
5       0.322822        383859        134816  
6       0.494295        314270        164157  
7       0.708793        116996         84808  
8       0.826146         30301         25270  
9       0.861872          6087          5305  
