/mnt/phd/jihu/opioid/Code/risk_test.py:36: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
/mnt/phd/jihu/opioid/Code/risk_test.py:549: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  FULL_filtered.rename(columns={'prescriber_yr_avg_days_quartile_binary': 'prescriber_yr_avg_days_median_binary',\
/mnt/phd/jihu/opioid/Code/risk_test.py:36: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
/mnt/phd/jihu/opioid/Code/risk_test.py:549: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  FULL_filtered.rename(columns={'prescriber_yr_avg_days_quartile_binary': 'prescriber_yr_avg_days_median_binary',\
/mnt/phd/jihu/opioid/Code/risk_test.py:36: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
/mnt/phd/jihu/opioid/Code/risk_test.py:549: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  FULL_filtered.rename(columns={'prescriber_yr_avg_days_quartile_binary': 'prescriber_yr_avg_days_median_binary',\
/mnt/phd/jihu/opioid/Code/risk_test.py:36: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
/mnt/phd/jihu/opioid/Code/risk_test.py:549: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  FULL_filtered.rename(columns={'prescriber_yr_avg_days_quartile_binary': 'prescriber_yr_avg_days_median_binary',\
Setting tag: _test_CV_median_countyKern
Stage: test, Scenario: CV, Max Points: 5, Max Features: 10, C0: None,        Intercept Upper Bound: None, Intercept Lower Bound: None, Balanced: False,            First: False, Upto180: False, Median: True, Feature Set: None, Cutoff Set: None, Essential Num: None, No Drug: False,                No Insurance: False, County Name: Kern, Setting Tag: _test_CV_median_countyKern
Start testing...
Start testing with LTOUR:
Intercept: -7

 - Condition: num_prior_prescriptions, Cutoff: 1, Score: 2
 - Condition: prescriber_yr_avg_days_quartile, Cutoff: 1, Score: 2
 - Condition: concurrent_MME, Cutoff: 40, Score: 1
 - Condition: age, Cutoff: 30, Score: 1
 - Condition: long_acting, Cutoff: 1, Score: 1
 - Condition: pharmacy_yr_avg_days_quartile, Cutoff: 1, Score: 1
/export/storage_cures/CURES/Processed/FULL_OPIOID_2018_INPUT.csv imported with shape (6816028, 127)
WARNING: Encoding quartile values to binary

Subsetting dataset to county Kern with 163145 prescriptions.
Test reults are saved with setting tag: _LTOUR_countyKern_2018
22873 13719
Feature: num_prior_prescriptions, Cutoff: 1
Feature: prescriber_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Feature: concurrent_MME, Cutoff: 40
Feature: age, Cutoff: 30
Feature: long_acting, Cutoff: 1
Feature: pharmacy_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Current working directory: /mnt/phd/jihu/opioid/Code
ROC information for riskSLIM saved to output/baseline/riskSLIM_roc_test_info_median_LTOUR_countyKern_2018.pkl, threshodls: [       inf 0.73105858 0.5        0.26894142 0.11920292 0.04742587
 0.01798621 0.00669285 0.00247262 0.00091105] with optimal threshold: 0.5
Calibration information for riskSLIM saved to output/baseline/riskSLIM_calibration_test_info_median_LTOUR_countyKern_2018.pkl
Test done!

                   Value
Accuracy           0.856
Recall             0.287
Precision          0.479
ROC AUC             0.83
PR AUC             0.375
Calibration error  0.041
       Prob  Num_presc     TN  ...  Observed Risk  Num_patients  Num_longterm
0  0.000911       5207   5199  ...       0.001536          5207            10
1  0.002473      21629  21537  ...       0.004254         21628           160
2  0.006693      26463  26227  ...       0.008918         26144           321
3  0.017986      24617  23204  ...       0.057399         19243           982
4  0.047426      30869  27721  ...       0.101979         25215          2575
5  0.119203      18169  14329  ...       0.211349         13016          2210
6  0.268941      22472  14904  ...       0.336775         12244          3007
7  0.500000      11958      0  ...       0.465713          5553          1927
8  0.731059       1761      0  ...       0.567291           819           360

[9 rows x 10 columns]
/export/storage_cures/CURES/Processed/FULL_OPIOID_2019_INPUT.csv imported with shape (6409165, 127)
WARNING: Encoding quartile values to binary

Subsetting dataset to county Kern with 150023 prescriptions.
Test reults are saved with setting tag: _LTOUR_countyKern_2019
22271 11171
Feature: num_prior_prescriptions, Cutoff: 1
Feature: prescriber_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Feature: concurrent_MME, Cutoff: 40
Feature: age, Cutoff: 30
Feature: long_acting, Cutoff: 1
Feature: pharmacy_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Current working directory: /mnt/phd/jihu/opioid/Code
ROC information for riskSLIM saved to output/baseline/riskSLIM_roc_test_info_median_LTOUR_countyKern_2019.pkl, threshodls: [       inf 0.73105858 0.5        0.26894142 0.11920292 0.04742587
 0.01798621 0.00669285 0.00247262 0.00091105] with optimal threshold: 0.5
Calibration information for riskSLIM saved to output/baseline/riskSLIM_calibration_test_info_median_LTOUR_countyKern_2019.pkl
Test done!

                   Value
Accuracy           0.857
Recall             0.269
Precision          0.537
ROC AUC            0.837
PR AUC             0.402
Calibration error  0.037
       Prob  Num_presc     TN  ...  Observed Risk  Num_patients  Num_longterm
0  0.000911       4662   4659  ...       0.000644          4662             6
1  0.002473      20663  20582  ...       0.003920         20657           125
2  0.006693      24268  24080  ...       0.007747         24069           288
3  0.017986      18069  17231  ...       0.046378         16288           877
4  0.047426      27151  24560  ...       0.095429         23740          2567
5  0.119203      18240  14161  ...       0.223629         10883          2002
6  0.268941      25799  17303  ...       0.329315         12497          3079
7  0.500000      10092      0  ...       0.518232          4689          1826
8  0.731059       1079      0  ...       0.708990           503           286

[9 rows x 10 columns]
Start testing with TableSF:
Intercept: -5

 - Condition: prescriber_yr_avg_days_quartile, Cutoff: 1, Score: 2
 - Condition: concurrent_MME, Cutoff: 100, Score: 1
 - Condition: num_prescribers_past180, Cutoff: 3, Score: 1
 - Condition: num_prior_prescriptions, Cutoff: 1, Score: 1
 - Condition: long_acting, Cutoff: 1, Score: 1
 - Condition: pharmacy_yr_avg_days_quartile, Cutoff: 1, Score: 1
/export/storage_cures/CURES/Processed/FULL_OPIOID_2018_INPUT.csv imported with shape (6816028, 127)
WARNING: Encoding quartile values to binary

Subsetting dataset to county Kern with 163145 prescriptions.
Test reults are saved with setting tag: _TableSF_countyKern_2018
22873 9811
Feature: prescriber_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Feature: concurrent_MME, Cutoff: 100
Feature: num_prescribers_past180, Cutoff: 3
Feature: num_prior_prescriptions, Cutoff: 1
Feature: long_acting, Cutoff: 1
Feature: pharmacy_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Current working directory: /mnt/phd/jihu/opioid/Code
ROC information for riskSLIM saved to output/baseline/riskSLIM_roc_test_info_median_TableSF_countyKern_2018.pkl, threshodls: [       inf 0.88079708 0.73105858 0.5        0.26894142 0.11920292
 0.04742587 0.01798621 0.00669285] with optimal threshold: 0.5
Calibration information for riskSLIM saved to output/baseline/riskSLIM_calibration_test_info_median_TableSF_countyKern_2018.pkl
Test done!

                   Value
Accuracy           0.856
Recall               0.2
Precision          0.467
ROC AUC            0.817
PR AUC             0.354
Calibration error  0.034
       Prob  Num_presc     TN  ...  Observed Risk  Num_patients  Num_longterm
0  0.006693      23576  23453  ...       0.005217         23575           198
1  0.017986      43323  42256  ...       0.024629         37251           532
2  0.047426      24443  22692  ...       0.071636         20595          1375
3  0.119203      34486  28847  ...       0.163516         27995          3947
4  0.268941      27506  17790  ...       0.353232         15059          3735
5  0.500000       7998      0  ...       0.449487          3921          1383
6  0.731059       1629      0  ...       0.537139           761           343
7  0.880797        184      0  ...       0.581522           103            50

[8 rows x 10 columns]
/export/storage_cures/CURES/Processed/FULL_OPIOID_2019_INPUT.csv imported with shape (6409165, 127)
WARNING: Encoding quartile values to binary

Subsetting dataset to county Kern with 150023 prescriptions.
Test reults are saved with setting tag: _TableSF_countyKern_2019
22271 7894
Feature: prescriber_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Feature: concurrent_MME, Cutoff: 100
Feature: num_prescribers_past180, Cutoff: 3
Feature: num_prior_prescriptions, Cutoff: 1
Feature: long_acting, Cutoff: 1
Feature: pharmacy_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Current working directory: /mnt/phd/jihu/opioid/Code
ROC information for riskSLIM saved to output/baseline/riskSLIM_roc_test_info_median_TableSF_countyKern_2019.pkl, threshodls: [       inf 0.88079708 0.73105858 0.5        0.26894142 0.11920292
 0.04742587 0.01798621 0.00669285] with optimal threshold: 0.5
/mnt/phd/jihu/opioid/Code/risk_test.py:36: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
/mnt/phd/jihu/opioid/Code/risk_test.py:549: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  FULL_filtered.rename(columns={'prescriber_yr_avg_days_quartile_binary': 'prescriber_yr_avg_days_median_binary',\
/mnt/phd/jihu/opioid/Code/risk_test.py:36: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
/mnt/phd/jihu/opioid/Code/risk_test.py:549: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  FULL_filtered.rename(columns={'prescriber_yr_avg_days_quartile_binary': 'prescriber_yr_avg_days_median_binary',\
Calibration information for riskSLIM saved to output/baseline/riskSLIM_calibration_test_info_median_TableSF_countyKern_2019.pkl
Test done!

                   Value
Accuracy           0.855
Recall             0.189
Precision          0.533
ROC AUC            0.833
PR AUC             0.388
Calibration error  0.036
       Prob  Num_presc     TN  ...  Observed Risk  Num_patients  Num_longterm
0  0.006693      22185  22087  ...       0.004417         22178           153
1  0.017986      35060  34718  ...       0.009755         33315           381
2  0.047426      21150  19875  ...       0.060284         18497          1202
3  0.119203      36674  30341  ...       0.172684         26261          3925
4  0.268941      27060  17046  ...       0.370067         13601          3690
5  0.500000       6731      0  ...       0.506463          3235          1318
6  0.731059       1055      0  ...       0.684360           512           299
7  0.880797        108      0  ...       0.722222            77            54

[8 rows x 10 columns]
Start testing with TableKern:
Intercept: -5

 - Condition: prescriber_yr_avg_days_quartile, Cutoff: 1, Score: 2
 - Condition: num_prescribers_past180, Cutoff: 3, Score: 1
 - Condition: concurrent_benzo, Cutoff: 1, Score: 1
 - Condition: num_prior_prescriptions, Cutoff: 1, Score: 1
 - Condition: long_acting, Cutoff: 1, Score: 1
 - Condition: pharmacy_yr_avg_days_quartile, Cutoff: 1, Score: 1
/export/storage_cures/CURES/Processed/FULL_OPIOID_2018_INPUT.csv imported with shape (6816028, 127)
WARNING: Encoding quartile values to binary

Subsetting dataset to county Kern with 163145 prescriptions.
Test reults are saved with setting tag: _TableKern_countyKern_2018
22873 12012
Feature: prescriber_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Feature: num_prescribers_past180, Cutoff: 3
Feature: concurrent_benzo, Cutoff: 1
Feature: num_prior_prescriptions, Cutoff: 1
Feature: long_acting, Cutoff: 1
Feature: pharmacy_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Current working directory: /mnt/phd/jihu/opioid/Code
ROC information for riskSLIM saved to output/baseline/riskSLIM_roc_test_info_median_TableKern_countyKern_2018.pkl, threshodls: [       inf 0.88079708 0.73105858 0.5        0.26894142 0.11920292
 0.04742587 0.01798621 0.00669285] with optimal threshold: 0.5
Calibration information for riskSLIM saved to output/baseline/riskSLIM_calibration_test_info_median_TableKern_countyKern_2018.pkl
Test done!

                   Value
Accuracy           0.856
Recall             0.248
Precision          0.472
ROC AUC             0.82
PR AUC             0.359
Calibration error  0.027
       Prob  Num_presc     TN  ...  Observed Risk  Num_patients  Num_longterm
0  0.006693      22791  22683  ...       0.004739         22790           174
1  0.017986      41732  40737  ...       0.023843         36384           486
2  0.047426      25357  23731  ...       0.064124         20826          1265
3  0.119203      33407  28307  ...       0.152663         27088          3499
4  0.268941      27846  18475  ...       0.336529         15745          3772
5  0.500000      10278      0  ...       0.462736          4989          1788
6  0.731059       1650      0  ...       0.526667           807           352
7  0.880797         84      0  ...       0.571429            47            25

[8 rows x 10 columns]
/export/storage_cures/CURES/Processed/FULL_OPIOID_2019_INPUT.csv imported with shape (6409165, 127)
WARNING: Encoding quartile values to binary

Subsetting dataset to county Kern with 150023 prescriptions.
Test reults are saved with setting tag: _TableKern_countyKern_2019
22271 9717
Feature: prescriber_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Feature: num_prescribers_past180, Cutoff: 3
Feature: concurrent_benzo, Cutoff: 1
Feature: num_prior_prescriptions, Cutoff: 1
Feature: long_acting, Cutoff: 1
Feature: pharmacy_yr_avg_days_quartile, Cutoff: 1
Should only be for Drug payment
Current working directory: /mnt/phd/jihu/opioid/Code
ROC information for riskSLIM saved to output/baseline/riskSLIM_roc_test_info_median_TableKern_countyKern_2019.pkl, threshodls: [       inf 0.88079708 0.73105858 0.5        0.26894142 0.11920292
 0.04742587 0.01798621 0.00669285] with optimal threshold: 0.5
Calibration information for riskSLIM saved to output/baseline/riskSLIM_calibration_test_info_median_TableKern_countyKern_2019.pkl
Test done!

                   Value
Accuracy           0.853
Recall             0.224
Precision          0.514
ROC AUC            0.831
PR AUC             0.382
Calibration error   0.03
       Prob  Num_presc     TN  ...  Observed Risk  Num_patients  Num_longterm
0  0.006693      21714  21617  ...       0.004467         21707           152
1  0.017986      34361  34034  ...       0.009517         32563           341
2  0.047426      20934  19750  ...       0.056559         18416          1093
3  0.119203      34918  29150  ...       0.165187         25175          3549
4  0.268941      28379  18476  ...       0.348955         14437          3729
5  0.500000       8573      0  ...       0.496676          4143          1638
6  0.731059       1080      0  ...       0.632407           552           312
7  0.880797         64      0  ...       0.796875            39            30

[8 rows x 10 columns]
