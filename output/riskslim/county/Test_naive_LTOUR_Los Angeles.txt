/mnt/phd/jihu/opioid/Code/risk_test.py:40: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
Setting tag: _test_CV_first_countyLos Angeles
Stage: test, Scenario: CV, Max Points: 5, Max Features: 10, C0: None,        Intercept Upper Bound: None, Intercept Lower Bound: None, Balanced: False,            First: True, Upto180: False, Feature Set: None, Cutoff Set: None, Essential Num: None, No Drug: False,                No Insurance: False, County Name: Los Angeles, Setting Tag: _test_CV_first_countyLos Angeles
Start testing...
Start testing with LTOUR_6:
Intercept: -5

 - Condition: days_supply, Cutoff: 10, Score: 2
 - Condition: num_prior_prescriptions, Cutoff: 1, Score: 2
 - Condition: daily_dose, Cutoff: 90, Score: 1
 - Condition: HMFO, Cutoff: 1, Score: 1
 - Condition: long_acting, Cutoff: 1, Score: 1
 - Condition: prescriber_yr_avg_days_above75, Cutoff: 1, Score: 1
Setting tag: _LTOUR_6_countyLos Angeles_first

/export/storage_cures/CURES/Processed/FULL_OPIOID_2019_INPUT.csv imported with shape (6409165, 151)
Subsetting dataset to first prescription only with (3635072, 151) prescriptions.
Subsetting dataset to county Los Angeles with 825495 prescriptions.
Test reults are saved with setting tag: _LTOUR_6_countyLos Angeles_first_2019
Current working directory: /mnt/phd/jihu/opioid/Code
ROC information for riskSLIM saved to output/baseline/files/riskSLIM_roc_test_info_LTOUR_6_countyLos Angeles_first_2019.pkl, threshodls: [       inf 0.95257413 0.88079708 0.73105858 0.5        0.26894142
 0.11920292 0.04742587 0.01798621 0.00669285] with optimal threshold: 0.01798620996209156
Calibration information for riskSLIM saved to output/baseline/files/riskSLIM_calibration_test_info_LTOUR_6_countyLos Angeles_first_2019.pkl
Test done!

                   Value
Accuracy           0.814
Recall             0.869
Precision          0.087
ROC AUC            0.883
PR AUC             0.174
Calibration error  0.007
       Prob  Num_presc      TN  ...  Observed Risk  Num_patients  Num_longterm
0  0.006693     659571  657394  ...       0.003301        659571          3293
1  0.017986      52174       0  ...       0.019588         52174          1473
2  0.047426      64721       0  ...       0.047898         64721          3733
3  0.119203      43398       0  ...       0.193788         43398          9449
4  0.268941       4607       0  ...       0.325591          4607          1593
5  0.500000        931       0  ...       0.359828           931           351
6  0.731059         84       0  ...       0.357143            84            34
7  0.880797          7       0  ...       0.428571             7             3
8  0.952574          2       0  ...       0.500000             2             1

[9 rows x 10 columns]
