/mnt/phd/jihu/opioid/Code/risk_train.py:76: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  FULL = pd.read_csv(file_path, delimiter=",", dtype={'concurrent_MME': float,
Setting tag: _train_single_p3_f6_c01e-15_interceptub10_interceptlb5_single_median_featureall_cutoffatmostone_group_essential1.0_nodrug
Stage: train, Scenario: single, Max Points: 3, Max Features: 6, C0: 1e-15,        Intercept Upper Bound: 10, Intercept Lower Bound: 5, Balanced: False,            First: False, Upto180: False, Median: True, Feature Set: all, Cutoff Set: atmostone_group, Essential Num: 1.0, No Drug: True,                No Insurance: False, County Name: None, Setting Tag: _train_single_p3_f6_c01e-15_interceptub10_interceptlb5_single_median_featureall_cutoffatmostone_group_essential1.0_nodrug
Start single training, file saved with setting tag _train_single_p3_f6_c01e-15_interceptub10_interceptlb5_single_median_featureall_cutoffatmostone_group_essential1.0_nodrug

/export/storage_cures/CURES/Processed/FULL_OPIOID_2018_INPUT.csv imported with shape (6816028, 127)
FULL_2018_Explore_STUMPS_median_
Finished importing STUMPS, with shape (6309458, 147)

Single cutoffs:
['concurrent_MME10', 'concurrent_MME15', 'concurrent_MME20', 'concurrent_MME25', 'concurrent_MME30', 'concurrent_MME35', 'concurrent_MME40', 'concurrent_MME45', 'concurrent_MME50', 'concurrent_MME75', 'concurrent_MME100', 'concurrent_MME200', 'concurrent_MME300']
['num_prescribers_past1802', 'num_prescribers_past1803']
['num_pharmacies_past1802', 'num_pharmacies_past1803']
['concurrent_benzo1']
['long_acting']
['Medicaid']
[]
['Medicare', 'Medicare_Medicaid']
['CashCredit']
[]
[]
[]
[]
['Medicare_Medicaid']
['num_prior_prescriptions1']
['diff_MME1']
['diff_days1']
['switch_drug']
['switch_payment']
['ever_switch_drug']
['ever_switch_payment']
['age30', 'age40', 'age50', 'age60', 'age70', 'age80']
['patient_gender']
['patient_zip_yr_avg_days3', 'patient_zip_yr_avg_days5', 'patient_zip_yr_avg_days7', 'patient_zip_yr_avg_days10', 'patient_zip_yr_avg_days14', 'patient_zip_yr_avg_days21', 'patient_zip_yr_avg_days25', 'patient_zip_yr_avg_days30', 'patient_zip_yr_avg_days60', 'patient_zip_yr_avg_days_quartile_0.0', 'patient_zip_yr_avg_days_quartile_1.0']
['patient_zip_yr_avg_MME10', 'patient_zip_yr_avg_MME15', 'patient_zip_yr_avg_MME20', 'patient_zip_yr_avg_MME25', 'patient_zip_yr_avg_MME30', 'patient_zip_yr_avg_MME35', 'patient_zip_yr_avg_MME40', 'patient_zip_yr_avg_MME45', 'patient_zip_yr_avg_MME50', 'patient_zip_yr_avg_MME75', 'patient_zip_yr_avg_MME100', 'patient_zip_yr_avg_MME200', 'patient_zip_yr_avg_MME300', 'patient_zip_yr_avg_MME_quartile_0.0', 'patient_zip_yr_avg_MME_quartile_1.0']
['patient_zip_yr_num_prescriptions_per_pop_quartile_0.0', 'patient_zip_yr_num_prescriptions_per_pop_quartile_1.0']
['patient_zip_yr_num_patients_per_pop_quartile_0.0', 'patient_zip_yr_num_patients_per_pop_quartile_1.0']
['prescriber_yr_num_prescriptions_quartile_0.0', 'prescriber_yr_num_prescriptions_quartile_1.0']
['prescriber_yr_num_patients_quartile_0.0', 'prescriber_yr_num_patients_quartile_1.0']
['prescriber_yr_num_pharmacies_quartile_0.0', 'prescriber_yr_num_pharmacies_quartile_1.0']
['prescriber_yr_avg_MME_quartile_0.0', 'prescriber_yr_avg_MME_quartile_1.0']
['prescriber_yr_avg_days_quartile_0.0', 'prescriber_yr_avg_days_quartile_1.0']
['pharmacy_yr_num_prescriptions_quartile_0.0', 'pharmacy_yr_num_prescriptions_quartile_1.0']
['pharmacy_yr_num_patients_quartile_0.0', 'pharmacy_yr_num_patients_quartile_1.0']
['pharmacy_yr_num_prescribers_quartile_0.0', 'pharmacy_yr_num_prescribers_quartile_1.0']
['pharmacy_yr_avg_MME_quartile_0.0', 'pharmacy_yr_avg_MME_quartile_1.0']
['pharmacy_yr_avg_days_quartile_0.0', 'pharmacy_yr_avg_days_quartile_1.0']
['patient_HPIQuartile_0.0', 'patient_HPIQuartile_1.0']
['zip_pop_density_quartile_0.0', 'zip_pop_density_quartile_1.0']
['median_household_income_quartile_0.0', 'median_household_income_quartile_1.0']
['family_poverty_pct_quartile_0.0', 'family_poverty_pct_quartile_1.0']
['unemployment_pct_quartile_0.0', 'unemployment_pct_quartile_1.0']
['Medicaid', 'Medicare', 'CashCredit', 'Medicare_Medicaid']
['patient_zip_yr_avg_days3', 'patient_zip_yr_avg_days5', 'patient_zip_yr_avg_days7', 'patient_zip_yr_avg_days10', 'patient_zip_yr_avg_days14', 'patient_zip_yr_avg_days21', 'patient_zip_yr_avg_days25', 'patient_zip_yr_avg_days30', 'patient_zip_yr_avg_days60', 'patient_zip_yr_avg_MME10', 'patient_zip_yr_avg_MME15', 'patient_zip_yr_avg_MME20', 'patient_zip_yr_avg_MME25', 'patient_zip_yr_avg_MME30', 'patient_zip_yr_avg_MME35', 'patient_zip_yr_avg_MME40', 'patient_zip_yr_avg_MME45', 'patient_zip_yr_avg_MME50', 'patient_zip_yr_avg_MME75', 'patient_zip_yr_avg_MME100', 'patient_zip_yr_avg_MME200', 'patient_zip_yr_avg_MME300', 'patient_zip_yr_avg_MME_quartile_0.0', 'patient_zip_yr_avg_MME_quartile_1.0', 'patient_zip_yr_avg_days_quartile_0.0', 'patient_zip_yr_avg_days_quartile_1.0', 'patient_zip_yr_num_prescriptions_per_pop_quartile_0.0', 'patient_zip_yr_num_prescriptions_per_pop_quartile_1.0', 'patient_zip_yr_num_patients_per_pop_quartile_0.0', 'patient_zip_yr_num_patients_per_pop_quartile_1.0']
['prescriber_yr_num_prescriptions_quartile_0.0', 'prescriber_yr_num_prescriptions_quartile_1.0', 'prescriber_yr_num_patients_quartile_0.0', 'prescriber_yr_num_patients_quartile_1.0', 'prescriber_yr_num_pharmacies_quartile_0.0', 'prescriber_yr_num_pharmacies_quartile_1.0', 'prescriber_yr_avg_MME_quartile_0.0', 'prescriber_yr_avg_MME_quartile_1.0', 'prescriber_yr_avg_days_quartile_0.0', 'prescriber_yr_avg_days_quartile_1.0']
['pharmacy_yr_num_prescriptions_quartile_0.0', 'pharmacy_yr_num_prescriptions_quartile_1.0', 'pharmacy_yr_num_patients_quartile_0.0', 'pharmacy_yr_num_patients_quartile_1.0', 'pharmacy_yr_num_prescribers_quartile_0.0', 'pharmacy_yr_num_prescribers_quartile_1.0', 'pharmacy_yr_avg_MME_quartile_0.0', 'pharmacy_yr_avg_MME_quartile_1.0', 'pharmacy_yr_avg_days_quartile_0.0', 'pharmacy_yr_avg_days_quartile_1.0']
['patient_HPIQuartile_0.0', 'patient_HPIQuartile_1.0', 'zip_pop_density_quartile_0.0', 'zip_pop_density_quartile_1.0', 'median_household_income_quartile_0.0', 'median_household_income_quartile_1.0', 'family_poverty_pct_quartile_0.0', 'family_poverty_pct_quartile_1.0', 'unemployment_pct_quartile_0.0', 'unemployment_pct_quartile_1.0']
------------------------------------------------------------
Two cutoffs
Essential cutoffs with lower bound: 1.0
['concurrent_MME10', 'concurrent_MME15', 'concurrent_MME20', 'concurrent_MME25', 'concurrent_MME30', 'concurrent_MME35', 'concurrent_MME40', 'concurrent_MME45', 'concurrent_MME50', 'concurrent_MME75', 'concurrent_MME100', 'concurrent_MME200', 'concurrent_MME300', 'num_prescribers_past1802', 'num_prescribers_past1803', 'num_pharmacies_past1802', 'num_pharmacies_past1803', 'concurrent_benzo1', 'num_prior_prescriptions1', 'diff_MME1', 'diff_days1', 'age30', 'age40', 'age50', 'age60', 'age70', 'age80', 'patient_zip_yr_avg_days3', 'patient_zip_yr_avg_days5', 'patient_zip_yr_avg_days7', 'patient_zip_yr_avg_days10', 'patient_zip_yr_avg_days14', 'patient_zip_yr_avg_days21', 'patient_zip_yr_avg_days25', 'patient_zip_yr_avg_days30', 'patient_zip_yr_avg_days60', 'patient_zip_yr_avg_MME10', 'patient_zip_yr_avg_MME15', 'patient_zip_yr_avg_MME20', 'patient_zip_yr_avg_MME25', 'patient_zip_yr_avg_MME30', 'patient_zip_yr_avg_MME35', 'patient_zip_yr_avg_MME40', 'patient_zip_yr_avg_MME45', 'patient_zip_yr_avg_MME50', 'patient_zip_yr_avg_MME75', 'patient_zip_yr_avg_MME100', 'patient_zip_yr_avg_MME200', 'patient_zip_yr_avg_MME300', 'long_acting', 'Medicaid', 'Medicare', 'CashCredit', 'switch_drug', 'switch_payment', 'ever_switch_drug', 'ever_switch_payment', 'patient_gender', 'patient_HPIQuartile_0.0', 'patient_HPIQuartile_1.0', 'patient_zip_yr_avg_MME_quartile_0.0', 'patient_zip_yr_avg_MME_quartile_1.0', 'patient_zip_yr_avg_days_quartile_0.0', 'patient_zip_yr_avg_days_quartile_1.0', 'patient_zip_yr_num_prescriptions_per_pop_quartile_0.0', 'patient_zip_yr_num_prescriptions_per_pop_quartile_1.0', 'patient_zip_yr_num_patients_per_pop_quartile_0.0', 'patient_zip_yr_num_patients_per_pop_quartile_1.0', 'prescriber_yr_num_prescriptions_quartile_0.0', 'prescriber_yr_num_prescriptions_quartile_1.0', 'prescriber_yr_num_patients_quartile_0.0', 'prescriber_yr_num_patients_quartile_1.0', 'prescriber_yr_num_pharmacies_quartile_0.0', 'prescriber_yr_num_pharmacies_quartile_1.0', 'prescriber_yr_avg_MME_quartile_0.0', 'prescriber_yr_avg_MME_quartile_1.0', 'prescriber_yr_avg_days_quartile_0.0', 'prescriber_yr_avg_days_quartile_1.0', 'pharmacy_yr_num_prescriptions_quartile_0.0', 'pharmacy_yr_num_prescriptions_quartile_1.0', 'pharmacy_yr_num_patients_quartile_0.0', 'pharmacy_yr_num_patients_quartile_1.0', 'pharmacy_yr_num_prescribers_quartile_0.0', 'pharmacy_yr_num_prescribers_quartile_1.0', 'pharmacy_yr_avg_MME_quartile_0.0', 'pharmacy_yr_avg_MME_quartile_1.0', 'pharmacy_yr_avg_days_quartile_0.0', 'pharmacy_yr_avg_days_quartile_1.0', 'zip_pop_density_quartile_0.0', 'zip_pop_density_quartile_1.0', 'median_household_income_quartile_0.0', 'median_household_income_quartile_1.0', 'family_poverty_pct_quartile_0.0', 'family_poverty_pct_quartile_1.0', 'unemployment_pct_quartile_0.0', 'unemployment_pct_quartile_1.0', 'Medicare_Medicaid']
------------------------------------------------------------
setting c0_value = 0.0 for (Intercept) to ensure that intercept is not penalized
05/04/25 @ 01:39 PM | switching loss computation from lookup to normal
05/04/25 @ 01:40 PM | ------------------------------------------------------------
05/04/25 @ 01:40 PM | runnning initialization procedure
05/04/25 @ 01:40 PM | ------------------------------------------------------------
05/04/25 @ 01:45 PM | CPA produced 2 cuts
05/04/25 @ 01:45 PM | running naive rounding on 4 solutions
05/04/25 @ 01:45 PM | best objective value: 0.3814
05/04/25 @ 01:45 PM | rounding produced 0 integer solutions
05/04/25 @ 01:45 PM | running sequential rounding on 4 solutions
05/04/25 @ 01:45 PM | best objective value: 0.3814
05/04/25 @ 01:45 PM | sequential rounding produced 0 integer solutions
05/04/25 @ 01:45 PM | initialization produced 0 feasible solutions
05/04/25 @ 01:45 PM | ------------------------------------------------------------
05/04/25 @ 01:45 PM | completed initialization procedure
05/04/25 @ 01:45 PM | ------------------------------------------------------------
05/04/25 @ 01:45 PM | switching loss computation from lookup to normal
register_callback

05/04/25 @ 01:45 PM | adding 486 initial cuts
+-----------------------------------------------+------------------+-----------+
| Pr(Y = +1) = 1.0/(1.0 + exp(-(-7 + score)))   |                  |           |
| ============================================= | ================ | ========= |
| num_prior_prescriptions1                      |         2 points |   + ..... |
| prescriber_yr_avg_days_quartile_1.0           |         2 points |   + ..... |
| concurrent_MME40                              |         1 points |   + ..... |
| age30                                         |         1 points |   + ..... |
| long_acting                                   |         1 points |   + ..... |
| pharmacy_yr_avg_days_quartile_1.0             |         1 points |   + ..... |
| ============================================= | ================ | ========= |
| ADD POINTS FROM ROWS 1 to 6                   |            SCORE |   = ..... |
+-----------------------------------------------+------------------+-----------+
-7 ['num_prior_prescriptions1', 'prescriber_yr_avg_days_quartile_1.0', 'concurrent_MME40', 'age30', 'long_acting', 'pharmacy_yr_avg_days_quartile_1.0'] [2. 2. 1. 1. 1. 1.]
{'intercept': -7, 'conditions': ['num_prior_prescriptions', 'prescriber_yr_avg_days_quartile', 'concurrent_MME', 'age', 'long_acting', 'pharmacy_yr_avg_days_quartile'], 'cutoffs': [1, '1', 40, 30, 1, '1'], 'scores': [2, 2, 1, 1, 1, 1]}
Finished riskSLIM in 6178.0 seconds

                         Train
Train accuracy           0.896
Train Recall             0.275
Train Precision          0.439
Train ROC AUC            0.854
Train PR AUC             0.324
Train Calibration error  0.016
